<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; connect-src https://bsky.social https://cdn.bsky.app https://video.bsky.app; img-src * data:; media-src *; style-src 'self' 'unsafe-inline'; script-src 'self';">
  <title>Bsky Dreams</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>

  <!-- ============================================================
       AUTH SCREEN — shown when no session is stored
  ============================================================ -->
  <div id="auth-screen" class="screen" aria-label="Sign in to BlueSky">
    <div class="auth-card">
      <div class="auth-logo" aria-hidden="true">
        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" width="56" height="56">
          <path d="M32 8C18.7 8 8 18.7 8 32s10.7 24 24 24 24-10.7 24-24S45.3 8 32 8z" fill="var(--color-accent)"/>
          <path d="M22 26c0-5.5 4.5-10 10-10s10 4.5 10 10c0 4-2.3 7.4-5.7 9.1L32 44l-4.3-8.9C24.3 33.4 22 30 22 26z" fill="#fff"/>
        </svg>
      </div>
      <h1 class="auth-title">Bsky Dreams</h1>
      <p class="auth-subtitle">A better window into BlueSky</p>

      <form id="auth-form" novalidate>
        <div class="field-group">
          <label for="auth-handle" class="field-label">BlueSky handle</label>
          <input
            type="text"
            id="auth-handle"
            name="handle"
            class="field-input"
            placeholder="you.bsky.social"
            autocomplete="username"
            autocapitalize="none"
            spellcheck="false"
            required
          >
        </div>
        <div class="field-group">
          <label for="auth-password" class="field-label">App Password</label>
          <input
            type="password"
            id="auth-password"
            name="password"
            class="field-input"
            placeholder="xxxx-xxxx-xxxx-xxxx"
            autocomplete="current-password"
            required
          >
          <p class="field-hint">
            Use an <a href="https://bsky.app/settings/app-passwords" target="_blank" rel="noopener">App Password</a>,
            not your main password. Generate one in BlueSky → Settings → App Passwords.
          </p>
        </div>
        <div id="auth-error" class="error-banner" hidden role="alert"></div>
        <button type="submit" class="btn btn-primary btn-full" id="auth-submit">
          Sign in
        </button>
      </form>
    </div>
  </div>

  <!-- ============================================================
       MAIN APP — shown when authenticated
  ============================================================ -->
  <div id="app-screen" class="screen" hidden aria-label="Bsky Dreams main interface">

    <!-- Top Navigation Bar -->
    <header class="top-bar" role="banner">
      <div class="top-bar-inner">
        <button class="nav-logo-btn" id="nav-home-btn" aria-label="Bsky Dreams home">
          <span class="nav-logo-mark" aria-hidden="true">☁</span>
          <span class="nav-logo-text">Bsky Dreams</span>
        </button>
        <nav class="top-nav" aria-label="Main navigation">
          <button class="nav-btn active" id="nav-search-btn" aria-current="page" data-view="search">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
            <span class="nav-label">Search</span>
          </button>
          <button class="nav-btn" id="nav-compose-btn" data-view="compose">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
            <span class="nav-label">Post</span>
          </button>
        </nav>
        <button class="nav-avatar-btn" id="nav-profile-btn" aria-label="Account and sign out">
          <img id="nav-avatar" src="" alt="" class="nav-avatar" aria-hidden="true">
          <span id="nav-handle" class="nav-handle-text"></span>
        </button>
      </div>
    </header>

    <!-- ---- SEARCH VIEW ---- -->
    <section id="view-search" class="view active" aria-labelledby="search-heading">
      <div class="view-inner">
        <h2 id="search-heading" class="sr-only">Search BlueSky</h2>
        <form id="search-form" class="search-bar" role="search">
          <label for="search-input" class="sr-only">Search posts, users, or topics</label>
          <input
            type="search"
            id="search-input"
            class="search-input"
            placeholder="Search posts, people, or topics…"
            autocomplete="off"
            autocapitalize="off"
            spellcheck="false"
          >
          <div class="search-filters" role="group" aria-label="Search filters">
            <button type="button" class="filter-chip active" data-filter="posts">Posts</button>
            <button type="button" class="filter-chip" data-filter="users">People</button>
            <button type="button" class="filter-chip" data-filter="latest">Latest</button>
          </div>
          <button type="submit" class="btn btn-primary search-submit">Search</button>
        </form>

        <div id="search-results" class="feed" aria-live="polite" aria-label="Search results">
          <div class="feed-empty">
            <p>Search for posts, people, or topics on BlueSky.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ---- COMPOSE VIEW ---- -->
    <section id="view-compose" class="view" hidden aria-labelledby="compose-heading">
      <div class="view-inner">
        <h2 id="compose-heading" class="view-heading">New Post</h2>
        <form id="compose-form" class="compose-form" novalidate>
          <div class="compose-row">
            <img id="compose-avatar" src="" alt="" class="compose-avatar" aria-hidden="true">
            <div class="compose-body">
              <textarea
                id="compose-text"
                class="compose-textarea"
                placeholder="What's on your mind?"
                maxlength="300"
                rows="4"
                aria-label="Post text"
              ></textarea>
              <div class="compose-footer">
                <span class="char-count" id="compose-char-count" aria-live="polite">300</span>
                <div class="compose-actions">
                  <div id="compose-error" class="error-banner" hidden role="alert"></div>
                  <button type="submit" class="btn btn-primary" id="compose-submit">Post</button>
                </div>
              </div>
            </div>
          </div>
        </form>
        <div id="compose-success" class="success-banner" hidden role="status">
          Posted! <a id="compose-post-link" href="#" target="_blank" rel="noopener">View on BlueSky ↗</a>
        </div>
      </div>
    </section>

    <!-- ---- THREAD / CONVERSATION VIEW ---- -->
    <section id="view-thread" class="view" hidden aria-labelledby="thread-heading">
      <div class="view-inner">
        <div class="thread-header">
          <button class="btn btn-ghost back-btn" id="thread-back-btn" aria-label="Back to search results">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20" aria-hidden="true"><path d="M15 18l-6-6 6-6"/></svg>
            Back
          </button>
          <h2 id="thread-heading" class="thread-heading">Conversation</h2>
        </div>

        <div id="thread-content" class="thread-content" aria-live="polite">
          <!-- Thread root + replies rendered here by app.js -->
        </div>

        <!-- Inline reply form (shown below thread) -->
        <div id="thread-reply-area" class="thread-reply-area" hidden>
          <h3 class="reply-area-heading">Reply to this post</h3>
          <form id="reply-form" class="compose-form" novalidate>
            <div class="compose-row">
              <img id="reply-avatar" src="" alt="" class="compose-avatar" aria-hidden="true">
              <div class="compose-body">
                <p class="reply-to-label">Replying to <strong id="reply-to-handle"></strong></p>
                <textarea
                  id="reply-text"
                  class="compose-textarea"
                  placeholder="Write your reply…"
                  maxlength="300"
                  rows="3"
                  aria-label="Reply text"
                ></textarea>
                <div class="compose-footer">
                  <span class="char-count" id="reply-char-count" aria-live="polite">300</span>
                  <div class="compose-actions">
                    <div id="reply-error" class="error-banner" hidden role="alert"></div>
                    <button type="submit" class="btn btn-primary" id="reply-submit">Reply</button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </section>

  </div><!-- /#app-screen -->

  <!-- ============================================================
       PROFILE DROPDOWN MENU
  ============================================================ -->
  <div id="profile-menu" class="dropdown-menu" hidden role="menu" aria-label="Account options">
    <div class="dropdown-header">
      <span id="menu-display-name" class="dropdown-display-name"></span>
      <span id="menu-handle" class="dropdown-handle"></span>
    </div>
    <button class="dropdown-item" id="menu-sign-out" role="menuitem">Sign out</button>
  </div>

  <!-- ============================================================
       IMAGE LIGHTBOX
  ============================================================ -->
  <div id="image-lightbox" class="image-lightbox" hidden role="dialog" aria-modal="true" aria-label="Image viewer">
    <button class="lightbox-close" id="lightbox-close" aria-label="Close image">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="20" height="20" aria-hidden="true"><path d="M18 6 6 18M6 6l12 12"/></svg>
    </button>
    <img id="lightbox-img" src="" alt="" class="lightbox-img">
    <p id="lightbox-caption" class="lightbox-caption"></p>
  </div>

  <!-- ============================================================
       LOADING OVERLAY
  ============================================================ -->
  <div id="loading-overlay" class="loading-overlay" hidden aria-live="assertive" aria-label="Loading">
    <div class="spinner" aria-hidden="true"></div>
  </div>

  <script src="js/hls.min.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/api.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
